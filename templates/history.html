{% extends "base.html" %}

{% block content %}
<head>
    <meta charset="utf-8">
    <title>éå»ã®è¨˜éŒ²</title>
</head>

<body>
    <h1>ğŸ“œ éå»ã®è¨˜éŒ²</h1>
    <a href="/record">â† æˆ»ã‚‹</a>
    <hr>

    {% for record in records %}
        <h2>{{ record.record_date.strftime('%Y-%m-%d') }}</h2>
        <p>ä½“é‡: {{ record.weight }} kg</p>
        <p>ç·ã‚«ãƒ­ãƒªãƒ¼: {{ record.total_calorie or 'æœªé›†è¨ˆ' }} kcal</p>
        <p>ç·å¡©åˆ†: {{ record.total_salt or 'æœªé›†è¨ˆ' }} g</p>

        <ul>
        {% for food in record.food_items %}
            <li>{{ food.time.strftime('%H:%M') }} - {{ food.name }}ï¼ˆ{{ food.calorie }} kcal / {{ food.salt }} gï¼‰</li>
        {% endfor %}
        </ul>
        <hr>
    {% endfor %}
    <h2>ğŸ“Š ä½“é‡ãƒ»ã‚«ãƒ­ãƒªãƒ¼ãƒ»å¡©åˆ†ã®æ¨ç§»ï¼ˆéå»30æ—¥ï¼‰</h2>
    <canvas id="trendChart" width="100%" height="40"></canvas>
    
    <!-- âœ… Chart.js èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- âœ… ã‚°ãƒ©ãƒ•æç”»ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
      const labels = {{ labels|tojson }};
      const weightData = {{ weight_data|tojson }};
      const calorieData = {{ calorie_data|tojson }};
      const saltData = {{ salt_data|tojson }};
    
      const ctx = document.getElementById('trendChart').getContext('2d');
      const trendChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'ä½“é‡ (kg)',
              data: weightData,
              borderColor: 'blue',
              fill: false
            },
            {
              label: 'ã‚«ãƒ­ãƒªãƒ¼ (kcal)',
              data: calorieData,
              borderColor: 'red',
              fill: false
            },
            {
              label: 'å¡©åˆ† (g)',
              data: saltData,
              borderColor: 'green',
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            },
            title: {
              display: true,
              text: 'ä½“é‡ãƒ»ã‚«ãƒ­ãƒªãƒ¼ãƒ»å¡©åˆ†ã®30æ—¥æ¨ç§»'
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    </script>

</body>
{% endblock %}
